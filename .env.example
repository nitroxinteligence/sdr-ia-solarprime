# ==================================================
# SDR IA SolarPrime - Configurações
# ==================================================
# Copie este arquivo para .env e preencha os valores
# ==================================================

# Ambiente
ENVIRONMENT=development
DEBUG=true
DOCKER_CONTAINER=false         # Define true se estiver rodando em Docker

# API Configuration
API_BASE_URL=http://localhost:8000
ALLOWED_ORIGINS=http://localhost:3000,http://localhost:8000
ALLOWED_HOSTS=localhost,127.0.0.1
UVICORN_WORKERS=1                     # IMPORTANTE: Usar apenas 1 worker para evitar problemas de concorrência no buffer

# Gemini AI Configuration
GEMINI_API_KEY=your_gemini_api_key_here

# Evolution API (WhatsApp)
EVOLUTION_API_URL=http://localhost:8080
EVOLUTION_API_KEY=your_evolution_api_key_here
EVOLUTION_INSTANCE_NAME=solarprime
EVOLUTION_INSTANCE_TOKEN=your_instance_token_here

# Webhook Security
WEBHOOK_SECRET=your_webhook_secret_here

# Business Logic
AI_RESPONSE_DELAY_SECONDS=2
TYPING_SIMULATION_ENABLED=true
MAX_MESSAGE_LENGTH=4096

# Message Buffer Configuration
MESSAGE_BUFFER_ENABLED=true           # Habilitar buffer de mensagens
MESSAGE_BUFFER_TIMEOUT=8.0            # Tempo de espera em segundos para agrupar mensagens
MESSAGE_BUFFER_MAX_MESSAGES=20        # Máximo de mensagens no buffer antes de processar
MESSAGE_BUFFER_MIN_INTERVAL=0.5       # Intervalo mínimo entre mensagens

# Message Chunking Configuration
MESSAGE_CHUNKING_ENABLED=true          # Habilitar divisão de mensagens
CHUNK_JOIN_PROBABILITY=0.6             # Probabilidade de juntar sentenças (0.0-1.0)
CHUNK_MAX_WORDS=30                     # Máximo de palavras por chunk
CHUNK_MIN_WORDS=3                      # Mínimo de palavras por chunk
CHUNK_MAX_CHARS=1200                   # Máximo de caracteres por chunk (WhatsApp: 1600)
CHUNK_TYPING_WORDS_PER_MINUTE=150      # Velocidade de digitação simulada
CHUNK_READING_WORDS_PER_MINUTE=200     # Velocidade de leitura estimada

# OpenAI Fallback Configuration
OPENAI_API_KEY=YOUR_OPENAI_API_KEY_HERE
OPENAI_MODEL=gpt-4.1-nano              # Modelo nano mais rápido e econômico da OpenAI
ENABLE_FALLBACK=true                   # Habilitar fallback para OpenAI
MAX_AI_RETRIES=3                       # Número máximo de tentativas
RETRY_DELAY_SECONDS=2                  # Delay inicial entre tentativas
RESPONSE_CACHE_TTL_MINUTES=60          # TTL do cache de respostas

# Kommo CRM
KOMMO_CLIENT_ID=your_kommo_client_id_here
KOMMO_CLIENT_SECRET=your_kommo_client_secret_here
KOMMO_SUBDOMAIN=your_subdomain
KOMMO_REDIRECT_URI=http://localhost:8000/auth/kommo/callback

# Kommo Pipeline Configuration
KOMMO_PIPELINE_ID=0

# Kommo Stage IDs
KOMMO_STAGE_NEW=0
KOMMO_STAGE_IN_QUALIFICATION=0
KOMMO_STAGE_QUALIFIED=0
KOMMO_STAGE_MEETING_SCHEDULED=0
KOMMO_STAGE_MEETING_CONFIRMED=0
KOMMO_STAGE_IN_NEGOTIATION=0
KOMMO_STAGE_PROPOSAL_SENT=0
KOMMO_STAGE_WON=0
KOMMO_STAGE_LOST=0

# Kommo Custom Field IDs
KOMMO_FIELD_LEAD_SOURCE=0
KOMMO_FIELD_WHATSAPP=0
KOMMO_FIELD_ENERGY_BILL=0
KOMMO_FIELD_SOLUTION_TYPE=0
KOMMO_FIELD_CURRENT_DISCOUNT=0
KOMMO_FIELD_COMPETITOR=0
KOMMO_FIELD_QUALIFICATION_SCORE=0
KOMMO_FIELD_AI_NOTES=0
KOMMO_FIELD_FOLLOW_UP_COUNT=0
KOMMO_FIELD_MEETING_DATETIME=0
KOMMO_FIELD_GOOGLE_CALENDAR_LINK=0
KOMMO_FIELD_MEETING_STATUS=0

# Kommo Responsible User IDs
KOMMO_USER_DEFAULT=0
KOMMO_USER_HIGH_VALUE=0
KOMMO_USER_INVESTMENT=0

# Kommo Solution Type Values
KOMMO_VALUE_USINA_PROPRIA=0
KOMMO_VALUE_USINA_PARCEIRA=0
KOMMO_VALUE_DESCONTO_ALTO=0
KOMMO_VALUE_DESCONTO_BAIXO=0
KOMMO_VALUE_INVESTIMENTO=0

# Supabase (será configurado posteriormente)
SUPABASE_URL=
SUPABASE_KEY=
SUPABASE_SERVICE_KEY=

# Database Pool Configuration
DB_POOL_MIN_SIZE=10              # Minimum connections in pool
DB_POOL_MAX_SIZE=50              # Maximum connections in pool
DB_POOL_MAX_QUERIES=50000        # Max queries per connection
DB_POOL_MAX_INACTIVE_LIFETIME=300 # Seconds before closing idle connections
DB_COMMAND_TIMEOUT=10             # Command timeout in seconds

# Redis/Celery (será configurado posteriormente)
REDIS_URL=redis://localhost:6379/0
CELERY_BROKER_URL=redis://localhost:6379/1
CELERY_RESULT_BACKEND=redis://localhost:6379/2

# Rate Limiting
RATE_LIMIT_DEFAULT=60              # Requisições por minuto (padrão)
RATE_LIMIT_WINDOW=60              # Janela em segundos
RATE_LIMIT_BURST=10               # Limite de burst
RATE_LIMIT_BURST_WINDOW=10        # Janela de burst em segundos
RATE_LIMIT_WEBHOOK=300            # Limite para webhook
RATE_LIMIT_SEND_MESSAGE=30        # Limite para envio de mensagens
RATE_LIMIT_API=120                # Limite geral da API
RATE_LIMIT_AUTO_BLOCK_THRESHOLD=5 # Violações para bloquear IP
RATE_LIMIT_AUTO_BLOCK_DURATION=3600 # Duração do bloqueio em segundos
RATE_LIMIT_WHITELIST_IPS=         # IPs permitidos (separados por vírgula)

# Reporting
WHATSAPP_GROUP_ID=
REPORT_DAY_OF_WEEK=1  # Segunda-feira
REPORT_TIME=09:00

# Logging
LOG_LEVEL=INFO

# Follow-up Configuration
ENABLE_FOLLOW_UP=true              # Habilitar sistema de follow-up
FOLLOW_UP_DELAY_MINUTES=30         # Primeiro follow-up após 30 minutos
FOLLOW_UP_SECOND_DELAY_HOURS=24    # Segundo follow-up após 24 horas

# Intelligent Follow-up Configuration
ENABLE_INTELLIGENT_FOLLOW_UP=true  # Habilitar follow-up inteligente com contexto completo
FOLLOW_UP_CONTEXT_MESSAGES=100     # Número de mensagens do histórico para análise
FOLLOW_UP_MIN_INTEREST_LEVEL=3     # Nível mínimo de interesse (0-10) para enviar follow-up

# Google Calendar Configuration
GOOGLE_CALENDAR_CREDENTIALS_PATH=credentials/google_calendar_credentials.json
GOOGLE_CALENDAR_TOKEN_PATH=credentials/google_calendar_token.pickle
GOOGLE_CALENDAR_ID=primary         # ID do calendário (primary = calendário principal)
MEETING_DURATION_MINUTES=60        # Duração padrão das reuniões
MEETING_LOCATION=SolarPrime - Av. Boa Viagem, 3344 - Boa Viagem, Recife - PE
BUSINESS_HOURS_START=9             # Início do expediente
BUSINESS_HOURS_END=18              # Fim do expediente